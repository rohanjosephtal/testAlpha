#circle.yml

machine:
  services:
    - docker

dependencies:
  override:
    - docker info
    - awk '/RUN apt-get update && apt-get upgrade -y/ { print; print "RUN export AWS_ACCESS_KEY_ID"=$AWS_ACCESS_KEY_ID"; next }1' Dockerfile
    - awk '/RUN apt-get install python-pip -y/ { print; print "RUN export AWS_SECRET_ACCESS_KEY"=$AWS_SECRET_ACCESS_KEY"; next }1' Dockerfile
    - sudo cat Dockerfile
    - docker build -t docker-registry-000-prod.avalonlabs.io/twiin-app-dev-accounts-v-000 .
    - docker push docker-registry-000-prod.avalonlabs.io/twiin-app-dev-accounts-v-000